Terminal execution:  True   (sys.argv[0]:  analysis-transformers-run.py )
Arguments passed via the terminal:

pimpo    dataset
500    sample_size_train
None    sample_size_corpus
20000    sample_size_no_topic
None    sample_size_test
nli_short    method
MoritzLaurer/deberta-v3-base-zeroshot-v1    model
transformer    vectorizer
20231026    study_date
pimpo-simple    task
2    n_run
6    n_random_runs_total
random1    group_sample
True    save_outputs
country_iso    group_column
448    max_length
Iteration number:  1
All random seeds:  [7270  860 5390 5191 5734 6265]
Random seed for this run:  860
deberta-v3-base-zeroshot-v
Dataset:  pimpo 

Overall label distribution per group member:
 country_iso            
aus          no_topic       3050
             supportive       71
             sceptical        34
             neutral          13
aut          no_topic       6716
             supportive      341
             sceptical       331
             neutral         108
can          no_topic       1495
             supportive       47
             neutral          21
             sceptical        16
che          no_topic       1714
             supportive      166
             sceptical       119
             neutral          30
deu          no_topic      13803
             supportive     1314
             sceptical       143
             neutral         115
dnk          no_topic       2051
             supportive      216
             sceptical       152
             neutral          94
esp          no_topic      13834
             supportive      521
             sceptical       141
             neutral         126
fin          no_topic       2880
             supportive      150
             sceptical        77
             neutral           9
irl          no_topic       5730
             supportive      117
             sceptical        34
             neutral          31
nld          no_topic      10421
             supportive      552
             sceptical       437
             neutral         115
nor          no_topic      11209
             supportive      781
             sceptical       228
             neutral          47
nzl          no_topic       1337
             neutral           6
             supportive        5
             sceptical         2
swe          no_topic       2651
             supportive      224
             neutral          55
             sceptical        43
usa          no_topic       3109
             supportive       85
             sceptical        43
             neutral           8
Name: label_text, dtype: int64
Group selected: ['esp']  for seed 860
Sample that might be imbalanced: df_train.label_text.value_counts:
 no_topic      300
neutral        66
sceptical      66
supportive     66
Name: label_text, dtype: int64

FINAL DF_TRAIN SAMPLE (BALANCED) for group \besp\b:
df_train.label_text.value_counts:
 no_topic      300
neutral        66
sceptical      66
supportive     66
Name: label_text, dtype: int64

For NLI: Augmenting data by adding random not_entail examples to the train set from other classes within the train set.
Length of df_train before this step is: 498.

Max augmentation can be: len(df_train) * 2 = 996. Can also be lower, if there are more entail examples than not-entail for a majority class
For NLI:  not_entail training examples were added, which leads to an augmented training dataset of length 894.
Number of hypotheses/classes:  4 

For normal test, N classifications necessary: 6792
For NLI test, N classifications necessary: 27168

Device: cuda
Map:   0%|          | 0/894 [00:00<?, ? examples/s]                                                   Map:   0%|          | 0/27168 [00:00<?, ? examples/s]Map:  15%|█▍        | 4000/27168 [00:00<00:00, 29159.21 examples/s]Map:  29%|██▉       | 8000/27168 [00:00<00:00, 30059.94 examples/s]Map:  44%|████▍     | 12000/27168 [00:00<00:00, 30864.19 examples/s]Map:  59%|█████▉    | 16000/27168 [00:00<00:00, 24800.41 examples/s]Map:  74%|███████▎  | 20000/27168 [00:00<00:00, 26978.03 examples/s]Map:  88%|████████▊ | 24000/27168 [00:00<00:00, 28522.98 examples/s]Map: 100%|██████████| 27168/27168 [00:00<00:00, 28403.87 examples/s]                                                                      0%|          | 0/196 [00:00<?, ?it/s]You're using a DebertaV2TokenizerFast tokenizer. Please note that with a fast tokenizer, using the `__call__` method is faster than using a method to encode the text followed by a call to the `pad` method to get a padded encoding.
  1%|          | 1/196 [00:00<00:31,  6.28it/s]  2%|▏         | 3/196 [00:00<00:23,  8.25it/s]  2%|▏         | 4/196 [00:00<00:22,  8.39it/s]  3%|▎         | 6/196 [00:00<00:21,  8.82it/s]  4%|▍         | 8/196 [00:00<00:19,  9.52it/s]  5%|▌         | 10/196 [00:01<00:18,  9.94it/s]  6%|▌         | 11/196 [00:01<00:19,  9.46it/s]  6%|▌         | 12/196 [00:01<00:20,  9.08it/s]  7%|▋         | 14/196 [00:01<00:18,  9.65it/s]  8%|▊         | 16/196 [00:01<00:17, 10.05it/s]  9%|▉         | 18/196 [00:01<00:17,  9.90it/s] 10%|█         | 20/196 [00:02<00:17, 10.31it/s] 11%|█         | 22/196 [00:02<00:16, 10.48it/s] 12%|█▏        | 24/196 [00:02<00:16, 10.66it/s] 13%|█▎        | 26/196 [00:02<00:15, 10.71it/s] 14%|█▍        | 28/196 [00:02<00:15, 10.63it/s]                                                 14%|█▍        | 28/196 [00:02<00:15, 10.63it/s] 15%|█▌        | 30/196 [00:03<00:15, 10.61it/s] 16%|█▋        | 32/196 [00:03<00:15, 10.36it/s] 17%|█▋        | 34/196 [00:03<00:16,  9.94it/s] 18%|█▊        | 36/196 [00:03<00:15, 10.12it/s] 19%|█▉        | 38/196 [00:03<00:16,  9.83it/s] 20%|█▉        | 39/196 [00:03<00:16,  9.44it/s] 20%|██        | 40/196 [00:04<00:16,  9.28it/s] 21%|██▏       | 42/196 [00:04<00:15,  9.93it/s] 22%|██▏       | 43/196 [00:04<00:15,  9.92it/s] 23%|██▎       | 45/196 [00:04<00:14, 10.19it/s] 24%|██▍       | 47/196 [00:04<00:14, 10.46it/s] 25%|██▌       | 49/196 [00:04<00:13, 10.67it/s] 26%|██▌       | 51/196 [00:05<00:13, 10.89it/s] 27%|██▋       | 53/196 [00:05<00:13, 10.95it/s] 28%|██▊       | 55/196 [00:05<00:13, 10.58it/s]                                                 29%|██▊       | 56/196 [00:05<00:13, 10.58it/s] 29%|██▉       | 57/196 [00:05<00:13, 10.65it/s] 30%|███       | 59/196 [00:05<00:13, 10.31it/s] 31%|███       | 61/196 [00:06<00:13, 10.15it/s] 32%|███▏      | 63/196 [00:06<00:13, 10.23it/s] 33%|███▎      | 65/196 [00:06<00:12, 10.41it/s] 34%|███▍      | 67/196 [00:06<00:12,  9.97it/s] 35%|███▌      | 69/196 [00:06<00:12, 10.26it/s] 36%|███▌      | 71/196 [00:07<00:12, 10.13it/s] 37%|███▋      | 73/196 [00:07<00:12, 10.23it/s] 38%|███▊      | 75/196 [00:07<00:11, 10.35it/s] 39%|███▉      | 77/196 [00:07<00:11, 10.64it/s] 40%|████      | 79/196 [00:07<00:11, 10.21it/s] 41%|████▏     | 81/196 [00:07<00:10, 10.52it/s] 42%|████▏     | 83/196 [00:08<00:11, 10.09it/s]                                                 43%|████▎     | 84/196 [00:08<00:11, 10.09it/s] 43%|████▎     | 85/196 [00:08<00:11,  9.74it/s] 44%|████▍     | 86/196 [00:08<00:11,  9.38it/s] 45%|████▍     | 88/196 [00:08<00:11,  9.31it/s] 46%|████▌     | 90/196 [00:08<00:10,  9.78it/s] 47%|████▋     | 92/196 [00:09<00:10, 10.14it/s] 48%|████▊     | 94/196 [00:09<00:09, 10.44it/s] 49%|████▉     | 96/196 [00:09<00:09, 10.72it/s] 50%|█████     | 98/196 [00:09<00:09, 10.77it/s] 51%|█████     | 100/196 [00:09<00:09, 10.67it/s] 52%|█████▏    | 102/196 [00:10<00:08, 10.50it/s] 53%|█████▎    | 104/196 [00:10<00:08, 10.26it/s] 54%|█████▍    | 106/196 [00:10<00:08, 10.50it/s] 55%|█████▌    | 108/196 [00:10<00:08, 10.73it/s] 56%|█████▌    | 110/196 [00:10<00:08, 10.21it/s] 57%|█████▋    | 112/196 [00:11<00:08, 10.46it/s]                                                  57%|█████▋    | 112/196 [00:11<00:08, 10.46it/s] 58%|█████▊    | 114/196 [00:11<00:07, 10.68it/s] 59%|█████▉    | 116/196 [00:11<00:07, 10.67it/s] 60%|██████    | 118/196 [00:11<00:07, 10.09it/s] 61%|██████    | 120/196 [00:11<00:07, 10.02it/s] 62%|██████▏   | 122/196 [00:11<00:07, 10.38it/s] 63%|██████▎   | 124/196 [00:12<00:07, 10.06it/s] 64%|██████▍   | 126/196 [00:12<00:06, 10.28it/s] 65%|██████▌   | 128/196 [00:12<00:06,  9.92it/s] 66%|██████▋   | 130/196 [00:12<00:06, 10.23it/s] 67%|██████▋   | 132/196 [00:12<00:06, 10.51it/s] 68%|██████▊   | 134/196 [00:13<00:05, 10.63it/s] 69%|██████▉   | 136/196 [00:13<00:05, 10.76it/s] 70%|███████   | 138/196 [00:13<00:05, 10.46it/s] 71%|███████▏  | 140/196 [00:13<00:05, 10.04it/s]                                                  71%|███████▏  | 140/196 [00:13<00:05, 10.04it/s] 72%|███████▏  | 142/196 [00:13<00:05,  9.98it/s] 73%|███████▎  | 144/196 [00:14<00:05,  9.91it/s] 74%|███████▍  | 146/196 [00:14<00:05,  9.74it/s] 75%|███████▌  | 147/196 [00:14<00:05,  9.55it/s] 76%|███████▌  | 149/196 [00:14<00:04,  9.97it/s] 77%|███████▋  | 151/196 [00:14<00:04, 10.24it/s] 78%|███████▊  | 153/196 [00:15<00:04, 10.46it/s] 79%|███████▉  | 155/196 [00:15<00:03, 10.57it/s] 80%|████████  | 157/196 [00:15<00:03, 10.79it/s] 81%|████████  | 159/196 [00:15<00:03, 10.80it/s] 82%|████████▏ | 161/196 [00:15<00:03,  9.90it/s] 83%|████████▎ | 163/196 [00:16<00:03,  9.73it/s] 84%|████████▍ | 165/196 [00:16<00:03, 10.06it/s] 85%|████████▌ | 167/196 [00:16<00:02, 10.40it/s]                                                  86%|████████▌ | 168/196 [00:16<00:02, 10.40it/s] 86%|████████▌ | 169/196 [00:16<00:02, 10.67it/s] 87%|████████▋ | 171/196 [00:16<00:02, 10.57it/s] 88%|████████▊ | 173/196 [00:16<00:02, 10.78it/s] 89%|████████▉ | 175/196 [00:17<00:02, 10.49it/s] 90%|█████████ | 177/196 [00:17<00:01, 10.41it/s] 91%|█████████▏| 179/196 [00:17<00:01, 10.55it/s] 92%|█████████▏| 181/196 [00:17<00:01, 10.26it/s] 93%|█████████▎| 183/196 [00:17<00:01, 10.55it/s] 94%|█████████▍| 185/196 [00:18<00:01, 10.71it/s] 95%|█████████▌| 187/196 [00:18<00:00, 10.57it/s] 96%|█████████▋| 189/196 [00:18<00:00, 10.65it/s] 97%|█████████▋| 191/196 [00:18<00:00, 10.71it/s] 98%|█████████▊| 193/196 [00:18<00:00, 10.85it/s] 99%|█████████▉| 195/196 [00:19<00:00,  9.78it/s]                                                 100%|██████████| 196/196 [00:19<00:00,  9.78it/s]                                                 100%|██████████| 196/196 [00:19<00:00,  9.78it/s]100%|██████████| 196/196 [00:19<00:00, 10.22it/s]
{'loss': 1.0277, 'learning_rate': 1.3500000000000001e-05, 'epoch': 1.0}
{'loss': 0.4084, 'learning_rate': 1.807692307692308e-05, 'epoch': 2.0}
{'loss': 0.2773, 'learning_rate': 1.4487179487179489e-05, 'epoch': 3.0}
{'loss': 0.2166, 'learning_rate': 1.0897435897435898e-05, 'epoch': 4.0}
{'loss': 0.1684, 'learning_rate': 7.307692307692308e-06, 'epoch': 5.0}
{'loss': 0.1248, 'learning_rate': 3.7179487179487184e-06, 'epoch': 6.0}
{'loss': 0.0794, 'learning_rate': 1.282051282051282e-07, 'epoch': 7.0}
{'train_runtime': 19.1852, 'train_samples_per_second': 326.188, 'train_steps_per_second': 10.216, 'train_loss': 0.32894291926403435, 'epoch': 7.0}

Train time: 19.27341341972351 

  0%|          | 0/107 [00:00<?, ?it/s]  2%|▏         | 2/107 [00:00<00:06, 16.63it/s]  4%|▎         | 4/107 [00:00<00:09, 10.37it/s]  6%|▌         | 6/107 [00:00<00:11,  9.12it/s]  7%|▋         | 7/107 [00:00<00:11,  8.84it/s]  7%|▋         | 8/107 [00:00<00:11,  8.85it/s]  8%|▊         | 9/107 [00:00<00:11,  8.89it/s]  9%|▉         | 10/107 [00:01<00:10,  9.05it/s] 10%|█         | 11/107 [00:01<00:10,  9.12it/s] 11%|█         | 12/107 [00:01<00:11,  8.41it/s] 13%|█▎        | 14/107 [00:01<00:10,  8.89it/s] 14%|█▍        | 15/107 [00:01<00:11,  8.30it/s] 15%|█▍        | 16/107 [00:01<00:10,  8.54it/s] 16%|█▌        | 17/107 [00:01<00:10,  8.79it/s] 17%|█▋        | 18/107 [00:01<00:09,  9.07it/s] 18%|█▊        | 19/107 [00:02<00:09,  8.92it/s] 19%|█▊        | 20/107 [00:02<00:10,  8.52it/s] 20%|█▉        | 21/107 [00:02<00:10,  8.51it/s] 21%|██        | 22/107 [00:02<00:09,  8.79it/s] 21%|██▏       | 23/107 [00:02<00:09,  8.57it/s] 22%|██▏       | 24/107 [00:02<00:09,  8.81it/s] 23%|██▎       | 25/107 [00:02<00:09,  8.77it/s] 24%|██▍       | 26/107 [00:03<00:12,  6.52it/s] 25%|██▌       | 27/107 [00:03<00:12,  6.63it/s] 26%|██▌       | 28/107 [00:03<00:11,  7.16it/s] 27%|██▋       | 29/107 [00:03<00:10,  7.71it/s] 28%|██▊       | 30/107 [00:03<00:09,  7.82it/s] 29%|██▉       | 31/107 [00:03<00:09,  7.95it/s] 30%|██▉       | 32/107 [00:03<00:09,  8.08it/s] 31%|███       | 33/107 [00:03<00:09,  7.69it/s] 32%|███▏      | 34/107 [00:04<00:09,  7.56it/s] 33%|███▎      | 35/107 [00:04<00:09,  7.90it/s] 34%|███▎      | 36/107 [00:04<00:08,  8.06it/s] 35%|███▍      | 37/107 [00:04<00:08,  8.12it/s] 36%|███▌      | 38/107 [00:04<00:08,  7.93it/s] 36%|███▋      | 39/107 [00:04<00:08,  7.74it/s] 37%|███▋      | 40/107 [00:04<00:09,  7.43it/s] 38%|███▊      | 41/107 [00:04<00:08,  7.52it/s] 39%|███▉      | 42/107 [00:05<00:08,  7.92it/s] 40%|████      | 43/107 [00:05<00:07,  8.13it/s] 41%|████      | 44/107 [00:05<00:07,  8.19it/s] 42%|████▏     | 45/107 [00:05<00:07,  8.56it/s] 43%|████▎     | 46/107 [00:05<00:07,  8.40it/s] 44%|████▍     | 47/107 [00:05<00:07,  8.44it/s] 45%|████▍     | 48/107 [00:05<00:06,  8.56it/s] 46%|████▌     | 49/107 [00:05<00:06,  8.64it/s] 47%|████▋     | 50/107 [00:05<00:06,  8.53it/s] 48%|████▊     | 51/107 [00:06<00:06,  8.62it/s] 49%|████▊     | 52/107 [00:06<00:06,  8.88it/s] 50%|████▉     | 53/107 [00:06<00:06,  8.79it/s] 50%|█████     | 54/107 [00:06<00:05,  8.85it/s] 51%|█████▏    | 55/107 [00:06<00:06,  8.46it/s] 52%|█████▏    | 56/107 [00:06<00:06,  8.25it/s] 53%|█████▎    | 57/107 [00:06<00:06,  8.14it/s] 54%|█████▍    | 58/107 [00:06<00:06,  7.97it/s] 55%|█████▌    | 59/107 [00:07<00:05,  8.17it/s] 56%|█████▌    | 60/107 [00:07<00:05,  8.28it/s] 57%|█████▋    | 61/107 [00:07<00:05,  8.15it/s] 58%|█████▊    | 62/107 [00:07<00:05,  8.25it/s] 59%|█████▉    | 63/107 [00:07<00:05,  8.02it/s] 60%|█████▉    | 64/107 [00:07<00:05,  7.75it/s] 61%|██████    | 65/107 [00:07<00:05,  7.59it/s] 62%|██████▏   | 66/107 [00:07<00:05,  7.73it/s] 63%|██████▎   | 67/107 [00:08<00:04,  8.15it/s] 64%|██████▎   | 68/107 [00:08<00:04,  8.57it/s] 64%|██████▍   | 69/107 [00:08<00:04,  8.34it/s] 65%|██████▌   | 70/107 [00:08<00:05,  6.76it/s] 66%|██████▋   | 71/107 [00:08<00:05,  7.18it/s] 67%|██████▋   | 72/107 [00:08<00:04,  7.49it/s] 68%|██████▊   | 73/107 [00:08<00:04,  7.13it/s] 69%|██████▉   | 74/107 [00:09<00:04,  7.73it/s] 70%|███████   | 75/107 [00:09<00:03,  8.27it/s] 71%|███████   | 76/107 [00:09<00:04,  7.74it/s] 72%|███████▏  | 77/107 [00:09<00:03,  8.07it/s] 73%|███████▎  | 78/107 [00:09<00:03,  8.26it/s] 74%|███████▍  | 79/107 [00:09<00:03,  8.43it/s] 75%|███████▍  | 80/107 [00:09<00:03,  7.87it/s] 76%|███████▌  | 81/107 [00:09<00:03,  8.35it/s] 77%|███████▋  | 82/107 [00:09<00:02,  8.65it/s] 79%|███████▊  | 84/107 [00:10<00:02,  8.43it/s] 79%|███████▉  | 85/107 [00:10<00:02,  8.67it/s] 80%|████████  | 86/107 [00:10<00:02,  8.56it/s] 81%|████████▏ | 87/107 [00:10<00:02,  8.65it/s] 82%|████████▏ | 88/107 [00:10<00:02,  8.69it/s] 83%|████████▎ | 89/107 [00:10<00:02,  7.77it/s] 84%|████████▍ | 90/107 [00:10<00:02,  7.89it/s] 85%|████████▌ | 91/107 [00:11<00:02,  7.46it/s] 86%|████████▌ | 92/107 [00:11<00:01,  7.81it/s] 87%|████████▋ | 93/107 [00:11<00:01,  8.27it/s] 89%|████████▉ | 95/107 [00:11<00:01,  8.62it/s] 90%|████████▉ | 96/107 [00:11<00:01,  8.67it/s] 91%|█████████ | 97/107 [00:11<00:01,  8.63it/s] 92%|█████████▏| 98/107 [00:11<00:01,  8.70it/s] 93%|█████████▎| 99/107 [00:12<00:00,  8.30it/s] 93%|█████████▎| 100/107 [00:12<00:00,  8.13it/s] 94%|█████████▍| 101/107 [00:12<00:00,  8.13it/s] 95%|█████████▌| 102/107 [00:12<00:00,  7.86it/s] 96%|█████████▋| 103/107 [00:12<00:00,  8.20it/s] 97%|█████████▋| 104/107 [00:12<00:00,  7.85it/s] 98%|█████████▊| 105/107 [00:12<00:00,  8.24it/s] 99%|█████████▉| 106/107 [00:12<00:00,  8.42it/s]100%|██████████| 107/107 [00:13<00:00,  8.18it/s]
Highest probability prediction per premise:  [2, 0, 1, 2, 2, 2, 2, 3, 0, 1, 2, 1, 0, 0, 0, 3, 2, 1, 0, 3]
Correct labels per premise:  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
Aggregate metrics:  {'f1_macro': 0.5470729526174969, 'f1_micro': 0.8006478209658422, 'accuracy_balanced': 0.5606218984493178, 'accuracy_not_b': 0.8006478209658422, 'precision_macro': 0.5439418352526864, 'recall_macro': 0.5606218984493178, 'precision_micro': 0.8006478209658422, 'recall_micro': 0.8006478209658422}
Detailed metrics:  {'neutral': {'precision': 0.17101449275362318, 'recall': 0.30256410256410254, 'f1-score': 0.2185185185185185, 'support': 195}, 'no_topic': {'precision': 0.9117765273311897, 'recall': 0.9074, 'f1-score': 0.9095829991980754, 'support': 5000}, 'sceptical': {'precision': 0.47629310344827586, 'recall': 0.4911111111111111, 'f1-score': 0.4835886214442013, 'support': 450}, 'supportive': {'precision': 0.6166832174776564, 'recall': 0.5414123801220575, 'f1-score': 0.5766016713091922, 'support': 1147}, 'accuracy': 0.8006478209658422, 'macro avg': {'precision': 0.5439418352526864, 'recall': 0.5606218984493178, 'f1-score': 0.5470729526174969, 'support': 6792}, 'weighted avg': {'precision': 0.8118224395968053, 'recall': 0.8006478209658422, 'f1-score': 0.805286087123531, 'support': 6792}} 


Test results:
{'eval_loss': 0.5549883842468262, 'eval_f1_macro': 0.5470729526174969, 'eval_f1_micro': 0.8006478209658422, 'eval_accuracy_balanced': 0.5606218984493178, 'eval_accuracy_not_b': 0.8006478209658422, 'eval_precision_macro': 0.5439418352526864, 'eval_recall_macro': 0.5606218984493178, 'eval_precision_micro': 0.8006478209658422, 'eval_recall_micro': 0.8006478209658422, 'eval_runtime': 13.2129, 'eval_samples_per_second': 2056.165, 'eval_steps_per_second': 8.098, 'epoch': 7.0}

Script done.


